
<html>

    <head>
        <title>Joseph Crispell | Blog - Polygons</title>
        <link href="../../default.css" rel="stylesheet" type="text/css">
        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109829558-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-109829558-1');
        </script>
    </head>

    <body>
        
        <!-- Insert Sidebar box -->
        <div id="sidebar" style="top: 43.5%">
            
            <pageLink><a href="../../index.html">Home</a></pageLink>
            <pageLink><a href="../../Blog.html">Blog</a></pageLink>
            <pageLink><a href="../../About.html">About</a></pageLink>
            <pageLink><a href="../../Outputs.html">Outputs</a></pageLink>
        </div>
        
        <!-- Insert Title -->
        <div id="title">
            <img src="../../BlogThumbnail.png" width="40%">
                
        </div>
        
        <!-- Insert Text Body -->
        <div id="mainText">
            
            <br><br><br>
            
            <h1>Getting polygon information from shape files&emsp;11-10-17</h1>
            
            <p>
                On the train back to Dublin after my meeting at <a href="https://www.afbini.gov.uk/">AFBINI</a>
                and passing the time writing this post.<br><br>
                
                I've used polygon data a few times so far. Here, I am using the term "polygon" to refer to a list of
                coordinates that detail the outline of something in space. For example, polygons are often used
                in geography to show the outlines of countries, regions, lakes, forests - all sorts of things.
                <br><br>
                
                For my research, I have had access to polygon data detailing the outlines of fields associated
                with particular farms, territories associated with badger social groups, and counties within
                the Republic of Ireland. Polygon information is most commonly stored in a shape (file ending
                with .shp) file, which is usually accompanied with a host of other files.<br><br>
                
                Although completely unreadable, for us, the shape file contains the outlines of polygons, as
                well as some associated information. For example, in the shape file detailing the outlines
                of all the counties within the Republic of Ireland (freely available
                <a href="https://www.townlands.ie/page/downloads">here</a>), each polygon has information
                about the particular county associated with it - name, area, population size, etc.<br><br>
                
                Below I've detailed some simple R commands to extract the coordinates and associated
                information of all polygons within a shape file:
            </p>
            
            <div id="codeBlock">
                # Install the "rgdal" package in order to read a shape file into R<br>
                install.packages("rgdal")<br><br>
                
                # Load the "rgdal" package<br>
                library("rgdal")<br><br>
                
                # Read in shape file and store as object with class: SpatialPolygonsDataFrame<br>
                spatialDataFrame &lt;- readOGR(fileName)<br><br>

                # Note the number of polygon sets - one for each ID<br>
                nSets &lt;- length(spatialDataFrame@polygons)<br><br>
                
                # Initialise a list to store the coordinates of each polygon within SpatialPolygonsDataFrame<br>
                polygonCoords &lt;- list()<br><br>
                
                # Loop through all the sets of polygons<br>
                for(setIndex in seq_len(nSets)){<br><br>
    
                &emsp;&emsp;# Get the ID of the current polygon set<br>
                &emsp;&emsp;id &lt;- spatialDataFrame@polygons[[setIndex]]@ID<br><br>
    
                &emsp;&emsp;# Note the number of polygons in the current set<br>
                &emsp;&emsp;nPolygons &lt;- length(spatialDataFrame@polygons[[setIndex]]@Polygons)<br><br>
    
                &emsp;&emsp;# Initialise a list to store the coordinates of each polygon in current set<br>
                &emsp;&emsp;polygons &lt;- list()<br><br>
    
                &emsp;&emsp;# Examine each polygon in current set<br>
                &emsp;&emsp;for(polygonIndex in seq_len(nPolygons)){<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Get the coordinates for the current polygon<br>
                &emsp;&emsp;&emsp;&emsp;coords &lt;- spatialDataFrame@polygons[[setIndex]]@Polygons[[polygonIndex]]@coords<br><br>

                &emsp;&emsp;&emsp;&emsp;# Store the lX and Y coords<br>
                &emsp;&emsp;&emsp;&emsp;polygons[[polygonIndex]] &lt;- coords<br>
                &emsp;&emsp;}<br><br>
    
                &emsp;&emsp;# Store the polygon coordinates<br>
                &emsp;&emsp;polygonCoords[[id]] &lt;- polygons<br>
                }<br><br>
                
                # Get the associated information for each polygon<br>
                # Note that each polygon's ID links to the row names in this table<br>
                polygonInfo &lt;- spatialDataFrame@data<br>
            </div>
            
            <p>
                Just a note - there are plenty of tools within R to work directly with the
                SpatialPolygonsDataFrame object that reading in a shape file produces. I was only
                interested in generating some simple figures in R, so I used the above code
                to extract the polygon information from the SpatialPolygonsDataFrame and
                store it in a more manageable format.<br><br>
                
                If nothing else, hopefully working on the above code has given me a little
                insight into the workings of a shape file and how R can handle it.<br><br>
                
                Once I've got the polygon information using the code above, this is the code
                I would use to plot it:
            </p>
            
            <div id="codeBlock">
                # Initialise variables to store the minimum and maximum X and Y coordinates<br>
                ranges &lt;- list("X"=c(Inf, -Inf), "Y"=c(Inf, -Inf))<br><br>
                
                # Find the minimum and maximum X and Y coordinates across all the polygons<br>
                for(key in names(coords)){<br>
                &emsp;&emsp;for(polygonIndex in seq_len(length(polygonCoords[[key]]))){<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Note the ranges of the X and Y axes of the current polygon<br>
                &emsp;&emsp;&emsp;&emsp;xRange &lt;- range(polygonCoords[[key]][[polygonIndex]][, 1])<br>
                &emsp;&emsp;&emsp;&emsp;yRange &lt;- range(polygonCoords[[key]][[polygonIndex]][, 2])<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Update X min if necessary<br>
                &emsp;&emsp;&emsp;&emsp;if(xRange[1] &lt; ranges$X[1]){<br>
                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ranges$X[1] &lt;- xRange[1]<br>
                &emsp;&emsp;&emsp;&emsp;}<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Update X max if necessary<br>
                &emsp;&emsp;&emsp;&emsp;if(xRange[2] &gt; ranges$X[2]){<br>
                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ranges$X[2] &lt;- xRange[2]<br><br>
                &emsp;&emsp;&emsp;&emsp;}<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Update Y min if necessary<br>
                &emsp;&emsp;&emsp;&emsp;if(yRange[1] &lt; ranges$Y[1]){<br>
                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ranges$Y[1] &lt;- yRange[1]<br><br>
                &emsp;&emsp;&emsp;&emsp;}<br><br>
      
                &emsp;&emsp;&emsp;&emsp;# Update Y max if necessary<br>
                &emsp;&emsp;&emsp;&emsp;if(yRange[1] &gt; ranges$Y[2]){<br>
                &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;ranges$Y[2] &lt;- yRange[2]<br>
                &emsp;&emsp;&emsp;&emsp;}<br>
                &emsp;&emsp;}<br>
                }<br><br>

                # Create an empty plot to add the polygons to<br>
                # yaxt="n"&emsp;Turns off Y axis<br>
                # xaxt="n"&emsp;Turns off X axis<br>
                # bty="n"&emsp;Removes box from around plot<br>
                # xlim=...&emsp;Setting X axis limits to match minimum and maximum X coordinates<br>
                # ylim=...&emsp;Setting Y axis limits to match minimum and maximum Y coordinates<br>
                plot(x=NULL, y=NULL, yaxt="n", "xlab="X", ylab="Y", bty="n",<br>
                    &emsp;xlim=ranges$X, ylim=ranges$Y)<br><br>

                # Add polygon shapes to plot<br>
                for(key in names(coords)){<br>
                &emsp;&emsp;for(polygonIndex in seq_len(length(polygonCoords[[key]]))){<br><br>

                    &emsp;&emsp;&emsp;&emsp;# Get the coordinates of the current polygon<br>
                    &emsp;&emsp;&emsp;&emsp;coords &lt;- polygonCoords[[key]][[polygonIndex]]<br><br>

                    &emsp;&emsp;&emsp;&emsp;# Plot the current polygon<br>
                    &emsp;&emsp;&emsp;&emsp;polygon(coords)<br>
                &emsp;&emsp;}<br>
                }
                
            </div>
            
            <p>
                Yikes that was alot to type! Pulling into Dublin. I hope the above is useful and there
                aren't too many mistakes in the code/text!
            </p>
            
        </div>
    </body>
</html>
