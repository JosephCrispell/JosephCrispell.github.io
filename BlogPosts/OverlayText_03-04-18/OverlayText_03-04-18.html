
<html>

    <head>
        <title>Joseph Crispell | Blog - Consensus</title>
        <link href="../../default.css" rel="stylesheet" type="text/css">

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-109829558-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-109829558-1');
        </script>
    </head>

    <body>

        <!-- Insert Sidebar box -->
        <div id="sidebar" style="top: 43.5%">

            <pageLink><a href="../../index.html">Home</a></pageLink>
            <pageLink><a href="../../Blog.html">Blog</a></pageLink>
            <pageLink><a href="../../About.html">About</a></pageLink>
            <pageLink><a href="../../Outputs.html">Outputs</a></pageLink>
        </div>

        <!-- Insert Title -->
        <div id="title">
            <img src="../../BlogThumbnail.png" width="40%">

        </div>

        <!-- Insert Text Body -->
        <div id="mainText">

            <br><br><br>

            <h1>Avoiding overlapping text labels in R plot&emsp;03-04-18</h1>

            <p>
                Another post with a GIF!<br><br>

                Imagine you've got two sets of values you want to compare. For example, height and weight. Plotting the values against one another can help you to see whether there is a relationship between the two. You'll probably find that short individuals are lighter.<br><br>

                I created some plots (in the GIF below) in <a href="https://www.r-project.org/">R</a>. I am comparing a set of 'X' values to 'Y' values and plotting some example text labels at each point.
            </p>

            <img src="OverlayText_Thumbnail.gif" width="80%" hspace="0.5%" vspace="1%">

            <p>
                The GIF shows a scatter plot without any labels, with labels that sometimes overlap, and lastly with labels that have been adjusted to avoid overlapping. The current post describes the method used to adjust the labels to avoid overlapping.<br><br>

                As usual, a method to avoid overlapping text labels already exists within <a href="https://www.r-project.org/">R</a> (<a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">ggrepel</a>), but I was keen to write my own.<br><br>

                It took me a wee while to get my method to work but the final version works with the following steps:<br>
                <ol>
                    <li>Create a scatter plot without labels (or any plot that you want to overlay points onto)</li>
                    <li>Create a set of points on a grid, within the limits of the scatter plot (use <c>par("usr")</c> to get the axis limits of the scatter plot), as alternative label locations</li>
                    <li>Remove any of the alternative label locations that fall within the space designated for each point's label (I used the <c>strheight()</c> and <c>strwidth()</c> functions for this)</li>
                    <li>Add labels to the scatter plot as long as they don't overlap with any other point's label. NOTE: can force all labels to be relocated, to avoid labels overlapping with points</li>
                    <li>For those points whose label overlaps with anothers, examine each alternative location from closest to farthest until you find one that won't overlap with any plotted labels</li>
                    <ul>
                        <li>Add a text label at the chosen location and plot a line back to the original point</li>
                        <li>Remove any of the alternative label locations that would overlap with the chosen location and its label</li>
                        <li>Change the point's coordinates to be those of the alternative location</li>
                    </ul>
                </ol>
            </p>

            <p>
                I've <a href="../CreatingAnRPackage_11-09-18/CreatingAnRPackage_11-09-18.html">written</a> the above code into an R package described <a href="https://github.com/JosephCrispell/addTextLabels">here</a>. An interesting problem, and there is plenty of room for improvement!<br><br>

                An interesting note! If the ranges of the X and Y axes are different, then the label placement will favour the axis with the larger range. I addressed this be rescaling the X axis:
            </p>

            <div id="codeBlock">

              # Get the axis limits<br>
              axisLimits &lt;- par("usr")<br><br>

              # Calculate the axis ranges<br>
              xRange &lt;- axisLimits[2] - axisLimits[1]<br>
              yRange &lt;- axisLimits[4] - axisLimits[3]<br><br>

              # Calculate the xFactor<br>
              xFactor &lt;- yRange / xRange<br>

              # Scale the X axis to match the scale of Y axis<br>
              xValuesRescaled &lt;- xValues * xFactor
            </div>

        </div>

    </body>

</html>
